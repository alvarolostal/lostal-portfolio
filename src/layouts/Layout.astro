---
// src/layouts/Layout.astro
interface Props {
  title: string;
  description: string;
}

const { title, description } = Astro.props;
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
---

<!doctype html>
<html lang="es" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no" />
    
    <!-- Mejorar la seguridad y rendimiento -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta http-equiv="X-XSS-Protection" content="1; mode=block" />
    <meta name="referrer" content="strict-origin-when-cross-origin" />
    
    <!-- DNS Prefetch y Preconnect para recursos externos -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com" />
    <link rel="dns-prefetch" href="//fonts.gstatic.com" />
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com" />
    <link rel="dns-prefetch" href="//www.googletagmanager.com" />
    
    <!-- Preconnect para cdnjs.cloudflare.com (Font Awesome) -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin />
    
    <!-- Resource hints para Google Analytics -->
    <link rel="dns-prefetch" href="//www.google-analytics.com" />
    <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin />
    
    <title>{title}</title>
    <meta name="description" content={description} />

    <!-- SEO Meta Tags -->
    <meta name="author" content="Álvaro Lostal" />
    <meta name="robots" content="index, follow" />
    <meta name="language" content="es" />
    <meta name="geo.region" content="ES-CB" />
    <meta name="geo.placename" content="Santander, Cantabria, España" />

    <!-- Open Graph -->
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL.href} />
    <meta property="og:image" content="https://lostal.dev/assets/alvaro.webp" />
    <meta property="og:locale" content="es_ES" />
    <meta property="og:site_name" content="Álvaro Lostal - Portfolio" />

    <!-- Twitter Cards -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content="https://lostal.dev/assets/alvaro.webp" />

    <!-- Canonical URL -->
    <link rel="canonical" href={canonicalURL} />

    <!-- Schema.org JSON-LD -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@graph": [
          {
            "@type": "Person",
            "@id": "https://lostal.dev/#person",
            "name": "Álvaro Lostal",
            "givenName": "Álvaro",
            "familyName": "Lostal",
            "jobTitle": ["Desarrollador Frontend", "Ingeniero Informático"],
            "description": "Desarrollador Web e Ingeniero Informático especializado en desarrollo web moderno con frameworks y tecnologías actuales",
            "url": "https://lostal.dev",
            "image": {
              "@type": "ImageObject",
              "url": "https://lostal.dev/assets/alvaro.webp",
              "caption": "Álvaro Lostal - Ingeniero Informático"
            },
            "address": {
              "@type": "PostalAddress",
              "addressLocality": "Santander",
              "addressRegion": "Cantabria",
              "addressCountry": "ES"
            },
            "email": "alvarolostal04@gmail.com",
            "sameAs": [
              "https://github.com/alvarolostal",
              "https://linkedin.com/in/alvarolostal"
            ],
            "knowsAbout": [
              "Desarrollo Web Frontend",
              "Frameworks modernos",
              "Tecnologías web actuales",
              "Diseño Web Responsivo",
              "UX/UI Design",
              "Optimización Web",
              "SEO",
              "Accesibilidad Web"
            ],
            "alumniOf": {
              "@type": "EducationalOrganization",
              "name": "Universidad Europea del Atlántico",
              "description": "Grado en Ingeniería Informática"
            },
            "hasCredential": {
              "@type": "EducationalOccupationalCredential",
              "name": "B2 First (FCE)",
              "credentialCategory": "Cambridge Assessment English",
              "dateCreated": "2021"
            }
          },
          {
            "@type": "WebSite",
            "@id": "https://lostal.dev/#website",
            "url": "https://lostal.dev",
            "name": "Álvaro Lostal - Desarrollador Frontend & Ingeniero Informático",
            "description": "Portfolio profesional de Álvaro Lostal, Desarrollador Web e Ingeniero Informático. Diseño de interfaces modernas con frameworks y tecnologías actuales",
            "publisher": {
              "@id": "https://lostal.dev/#person"
            },
            "inLanguage": "es-ES",
            "copyrightYear": "2025",
            "datePublished": "2024-01-01",
            "dateModified": "2025-10-20"
          },
          {
            "@type": "ProfessionalService",
            "@id": "https://lostal.dev/#service",
            "name": "Álvaro Lostal - Desarrollo Web Frontend",
            "description": "Servicios de desarrollo web frontend, diseño de interfaces y consultoría técnica",
            "provider": {
              "@id": "https://lostal.dev/#person"
            },
            "areaServed": {
              "@type": "Country",
              "name": "España"
            },
            "serviceType": [
              "Desarrollo Web Frontend",
              "Diseño UX/UI",
              "Consultoría Técnica",
              "Optimización Web"
            ]
          },
          {
            "@type": "CreativeWork",
            "@id": "https://lostal.dev/#project-vivenza",
            "name": "Rediseño Vivenza Expo",
            "description": "Rediseño completo de la landing page de Vivenza Expo, aplicando principios de diseño moderno",
            "creator": {
              "@id": "https://lostal.dev/#person"
            },
            "dateCreated": "2024",
            "genre": "Desarrollo Web",
            "keywords": [
              "Rediseño Web",
              "Frameworks modernos",
              "Tecnologías web actuales",
              "Diseño Responsivo"
            ],
            "url": "https://vivenza.netlify.app/",
            "isBasedOn": "https://vivenzaexpo.es/"
          }
        ]
      }
    </script>

    <!-- Google tag (gtag.js) - Carga optimizada con timeout -->
    <script is:inline>
      // Cargar GA4 de forma asíncrona con delay para no competir con recursos críticos
      window.addEventListener('load', function() {
        // Esperar un poco para que se carguen los recursos críticos primero
        setTimeout(function() {
          // Crear y cargar el script de GA4
          const gaScript = document.createElement('script');
          gaScript.async = true;
          gaScript.src = 'https://www.googletagmanager.com/gtag/js?id=G-0Q34SCCETB';
          document.head.appendChild(gaScript);
          
          // Configurar GA4 con opciones de privacidad
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          window.gtag = gtag;
          gtag('js', new Date());
          gtag('config', 'G-0Q34SCCETB', {
            // Configuración de privacidad mejorada
            anonymize_ip: true,
            cookie_flags: 'SameSite=Lax;Secure',
            allow_google_signals: false,
            allow_ad_personalization_signals: false
          });
        }, 1000); // Delay de 1 segundo
      });
    </script>

    <!-- Favicon - Configuración completa con transparencia -->
    <!-- SVG para navegadores modernos (vector, transparente, perfecto) -->
    <link rel="icon" href="/assets/favicons/favicon.svg" type="image/svg+xml" />

    <!-- ICO para Google Search y compatibilidad legacy -->
    <link
      rel="icon"
      href="/assets/favicons/favicon.ico"
      sizes="16x16 32x32 48x48"
      type="image/x-icon"
    />

    <!-- PNG fallbacks transparentes en orden de preferencia -->
    <link rel="icon" href="/assets/favicons/favicon-32x32.png" sizes="32x32" type="image/png" />
    <link rel="icon" href="/assets/favicons/favicon-16x16.png" sizes="16x16" type="image/png" />

    <!-- Apple Touch Icon para iOS -->
    <link rel="apple-touch-icon" href="/assets/favicons/apple-touch-icon.png" sizes="180x180" />

    <!-- Web App Manifest -->
    <link rel="manifest" href="/site.webmanifest" />

    <!-- Fallback adicional -->
    <link rel="shortcut icon" href="/assets/favicons/favicon.ico" />
    <meta name="theme-color" content="#ffffff" />

    <!-- Inline script para aplicar tema inmediatamente sin flash -->
    <script>
      (function () {
        function getSystemTheme() {
          return window.matchMedia &&
            window.matchMedia('(prefers-color-scheme: dark)').matches
            ? 'dark'
            : 'light';
        }

        function getInitialTheme() {
          // Verificar si hay override manual de esta sesión
          const manualOverride = sessionStorage.getItem('themeManualOverride');

          if (manualOverride === 'true') {
            const manualTheme = localStorage.getItem('theme');
            if (manualTheme) {
              return manualTheme;
            }
          }

          // Si no hay override manual, usar tema del sistema
          return getSystemTheme();
        }

        // Aplicar tema inmediatamente
        const theme = getInitialTheme();
        document.documentElement.setAttribute('data-theme', theme);

        // Añadir clase para prevenir transiciones durante la carga inicial
        document.documentElement.classList.add('theme-loading');

        // Remover la clase después de que la página haya cargado
        document.addEventListener('DOMContentLoaded', function () {
          setTimeout(function () {
            document.documentElement.classList.remove('theme-loading');
          }, 100);
        });
      })();
    </script>

    <!-- Fonts - Carga crítica optimizada -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    
    <!-- Preload de fuentes críticas más importantes -->
    <link
      rel="preload"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      as="style"
      onload="this.onload=null;this.rel='stylesheet'"
    />
    
    <!-- Fuentes adicionales cargadas después del evento load -->
    <script is:inline>
      window.addEventListener('load', function() {
        const additionalFonts = document.createElement('link');
        additionalFonts.rel = 'stylesheet';
        additionalFonts.href = 'https://fonts.googleapis.com/css2?family=Inter:wght@300;500;800;900&family=Poppins:wght@400;500;600;700;800;900&display=swap';
        document.head.appendChild(additionalFonts);
      });
    </script>
    
    <noscript>
      <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
        rel="stylesheet"
      />
      <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;800;900&family=Poppins:wght@400;500;600;700;800;900&display=swap"
        rel="stylesheet"
      />
    </noscript>

    <!-- Font Awesome - Carga completamente asíncrona y optimizada -->
    <style>
      /* Fallback básico con fuentes del sistema mientras cargan los iconos */
      .fa, .fas, .far, .fab {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
        font-display: swap;
        /* Ocultar temporalmente hasta que carguen las fuentes reales */
        visibility: hidden;
      }
      
      /* Una vez que las fuentes están cargadas, mostrar los iconos */
      .fonts-loaded .fa, .fonts-loaded .fas, .fonts-loaded .far, .fonts-loaded .fab {
        font-family: "Font Awesome 6 Free", -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
        visibility: visible;
      }
      .fonts-loaded .fab {
        font-family: "Font Awesome 6 Brands", -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
      }
      .fonts-loaded .far {
        font-weight: 400;
      }
      .fonts-loaded .fas {
        font-weight: 900;
      }
    </style>
    
    <!-- Font Awesome - Carga optimizada con preload -->
    <link
      rel="preload"
      href="/assets/fontawesome/all.min.css"
      as="style"
      onload="this.onload=null;this.rel='stylesheet';document.documentElement.classList.add('fonts-loaded')"
    />
    <noscript>
      <link
        rel="stylesheet"
        href="/assets/fontawesome/all.min.css"
      />
    </noscript>
  </head>
  <body>
    <a href="#main" class="skip-link">Saltar al contenido principal</a>
    <slot />
  </body>
</html>

<style is:global>
  @import '../styles/variables.css';
  @import '../styles/global.css';
  @import '../styles/font-optimization.css';
  @import '../styles/navigation.css';
  @import '../styles/hero.css';
  @import '../styles/sections.css';
  @import '../styles/components.css';
  @import '../styles/floating-contact.css';
</style>

<script>
  import '../scripts/theme.js';
  import '../scripts/navigation.js';
  import '../scripts/animations.js';
  import '../scripts/auto-scroll.js';
  import '../scripts/floating-contact.js';
</script>
